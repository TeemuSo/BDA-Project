---
title: "ProjectFirst"
author: "Teemu Sormunen, Abdullah GÃ¼nay, Nicola Brazzale"
date: "11/18/2020"
header-includes:
  - \usepackage[numbers]{natbib}
# Citations
bibliography: ./citations/sources.bib
# csl: ./citations/vancouver-brackets.csl unnecessary?

output: 
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    citation_package: natbib

---

\newpage

# Introduction

## The problem

Write about heart diseases, whats the problem? (not knowing when patient is dying?)
[@origpaper]

## The motivation

Why do we need to solve this problem of predicting deaths? 
[@origpaper]

## Modeling idea

Multilevel models


# Dataset

## Term explanation  

Some of the terms in the dataset might not be familiar, and they are opened briefly here.

* **Creatine phosphokinase (CPK)**  
CPK is an enzyme, which helps to regulate the concentration of adenosine triphosphate (ATP) in cells. ATP is responsible for carrying energy. If the CPK level is high, it often means that there has been an injury or stress on a muscle tissue.   
* **Ejection fraction (EF)**  
EF is a measurement which describes how much blood left ventricle pumps out of heart with each contraction.
Low EF might indicate potential heart issues.  
* **Platelets**  
Platelets are small cell fragments which can form clots. 
Too many platelets can lead to clotting of blood vessels, 
which in turn can lead to heart attack.

* **Serum creatinine**  
...

* **serum sodium**  
...

## Dataset introduction

The dataset of 299 patients was produced as a result of study [@origpaper] from Pakistani's city Faisalabad.
All of the patients were over 40 years old, each having ventricular systolic dysfunction. This means that patient has poor left ventricular ejection fraction.
EF, serum creatinine and platelets are categorical variables, and age, serum sodium and CPK are continuous variables.  
Statistical analysis by [@origpaper] found age, creatinine, sodium, anemia and BP as significant variables.

\newpage
# Packages
```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(corrplot)
```

Load data
```{r}
file.name <- './data/heart_failure_clinical_records_dataset.csv'
heart <- read_csv(file.name)
```

Plot histograms

```{r}
ggplot(heart, aes(x=age)) + geom_histogram(aes(fill=as.character(sex)), bins = 30) + labs(fill = "Sex")

ggplot(heart, aes(x=age)) + geom_histogram(aes(fill=as.character(DEATH_EVENT)), bins = 30) + labs(fill = "Death")

ggplot(heart, aes(x=creatinine_phosphokinase)) + geom_histogram(aes(fill=as.character(DEATH_EVENT)), bins = 30) + labs(fill = "Death")

ggplot(heart, aes(x=ejection_fraction)) + geom_histogram(aes(fill=as.character(DEATH_EVENT)), bins = 30) + labs(fill = "Death")

ggplot(heart, aes(x=platelets)) + geom_histogram(aes(fill=as.character(DEATH_EVENT)), bins = 30) + labs(fill = "Death")

ggplot(heart, aes(x=serum_creatinine)) + geom_histogram(aes(fill=as.character(DEATH_EVENT)), bins = 30) + labs(fill = "Death")

```





Correlation matrix

```{r}
pred <- c("high_blood_pressure", "age", "sex", "creatinine_phosphokinase", "diabetes", "ejection_fraction", "platelets", "serum_creatinine", "serum_sodium", "smoking", "anaemia") 
target <- c("DEATH_EVENT")
#formula <- paste("DEATH_EVENT ~", paste(pred, collapse = "+"))
p <- length(pred)
n <- nrow(heart)
x = cor(heart[, c(target,pred)]) 
corrplot(x)
```

```{r}
#PRIORS ?
# 1 LINEAR MODEL WITH VARIABLE SELECTION
# 2 LINEAR MODEL WITH ALL VARIABLES
# HIERARCHICAL - in the Titanic one a hier. model have been used so we can use that one for reference

# All models with bernoulli outcome (1-0, death or not)
```

# References